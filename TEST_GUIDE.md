# 测试指南

## 🧪 v2.2.0 新功能测试

### 测试目标

验证以下两个新功能：
1. ✅ 图片自动压缩（1200px 限制）
2. ✅ UI 空间优化（隐藏上传区域）

---

## 📱 测试步骤

### 测试 1: 图片压缩功能

#### 准备测试图片

| 类型 | 尺寸 | 预期结果 |
|-----|------|---------|
| 大图 | 3000×2000 | 压缩到 1200×800 |
| 长图 | 1000×3000 | 压缩到 400×1200 |
| 宽图 | 3000×1000 | 压缩到 1200×400 |
| 小图 | 800×600 | 保持 800×600 |

#### 测试步骤

1. **启动服务**
   ```bash
   npm start
   ```

2. **PC 端打开**
   - 访问 `http://localhost:3000`
   - 等待二维码生成

3. **手机扫码**
   - 扫描二维码
   - 进入上传页面

4. **选择大图（3000×2000）**
   - 点击"选择图片"
   - 选择一张大图
   - 观察处理过程

5. **验证结果**
   
   **期望看到**：
   ```
   正在处理图片... (加载提示)
   ↓
   文件名: xxx.jpg
   原始大小: 5.20 MB
   压缩后: 450.00 KB
   
   ✅ 已压缩 91.3%
   📐 尺寸: 3000×2000 → 1200×800
   ```

6. **验证 UI 变化**
   
   **期望看到**：
   - ✅ 上传区域（📁 点击选择图片）消失
   - ✅ 只显示预览图片
   - ✅ 显示压缩信息
   - ✅ 显示上传和更换按钮

7. **上传图片**
   - 点击"📤 上传图片"
   - 观察 PC 端接收

8. **验证 PC 端**
   - ✅ 图片显示清晰
   - ✅ 添加到历史记录
   - ✅ 统计信息更新

---

### 测试 2: 小图不压缩

#### 测试步骤

1. **选择小图（800×600）**
   - 选择一张小于 1200px 的图片

2. **验证结果**
   
   **期望看到**：
   ```
   文件名: small.jpg
   原始大小: 180.00 KB
   尺寸: 800×600
   
   ℹ️ 图片尺寸适中，无需压缩
   ```

3. **验证**
   - ✅ 没有显示"压缩后"大小
   - ✅ 显示原始尺寸
   - ✅ 提示"无需压缩"

---

### 测试 3: 更换图片功能

#### 测试步骤

1. **选择第一张图片**
   - 上传区域消失
   - 显示预览

2. **点击"🔄 更换图片"**
   
   **期望看到**：
   - ✅ 上传区域重新显示
   - ✅ 预览区域消失
   - ✅ 文件选择框自动打开

3. **选择第二张图片**
   - 重新处理压缩
   - 重新隐藏上传区域
   - 显示新图片预览

---

### 测试 4: 连续上传

#### 测试步骤

1. **上传第一张**
   - 选择图片
   - 点击上传
   - 等待成功

2. **验证自动清空**
   
   **期望看到**（2秒后）：
   - ✅ 预览消失
   - ✅ 上传区域重新显示
   - ✅ 可以立即选择新图片

3. **上传第二张**
   - 重复流程
   - 验证 PC 端显示两张图片

---

### 测试 5: 不同屏幕尺寸

#### 测试设备

- [ ] iPhone SE (小屏)
- [ ] iPhone 12/13 (标准)
- [ ] iPhone Pro Max (大屏)
- [ ] Android 小屏
- [ ] Android 大屏
- [ ] iPad

#### 验证要点

1. **预览高度**
   - 大屏: 300px
   - 小屏(<700px): 200px

2. **按钮可见性**
   - ✅ 上传按钮始终可见
   - ✅ 更换按钮始终可见
   - ✅ 无需滚动

3. **空间节约**
   - ✅ 上传区域隐藏后更紧凑
   - ✅ 所有信息都能看到

---

## 🎯 压缩效果验证

### 压缩率测试

| 原图尺寸 | 原始大小 | 压缩后尺寸 | 压缩后大小 | 压缩率 |
|---------|---------|-----------|-----------|--------|
| 4000×3000 | 8 MB | 1200×900 | ~600 KB | ~92% |
| 3000×2000 | 5 MB | 1200×800 | ~450 KB | ~91% |
| 2000×2000 | 3 MB | 1200×1200 | ~500 KB | ~83% |
| 1000×3000 | 4 MB | 400×1200 | ~200 KB | ~95% |
| 800×600 | 180 KB | 800×600 | ~180 KB | 0% |

### 验证方法

1. **查看文件信息**
   - 移动端显示的压缩信息
   - 原始大小 vs 压缩后大小

2. **计算压缩率**
   ```
   压缩率 = (1 - 压缩后 / 原始) × 100%
   ```

3. **验证尺寸**
   - 开发者工具检查图片实际尺寸
   - 确认不超过 1200px

---

## 🐛 错误场景测试

### 测试 1: 超大文件

**测试步骤**：
1. 选择一张 20MB+ 的图片
2. 观察处理过程

**期望结果**：
- 可能处理较慢（1-2秒）
- 最终成功压缩
- 或显示"图片处理失败"

---

### 测试 2: 特殊格式

**测试文件**：
- PNG 透明图
- GIF 动图
- WebP 格式

**期望结果**：
- 都能正常处理
- 转换为 JPEG 格式
- 透明背景变为白色

---

### 测试 3: 网络中断

**测试步骤**：
1. 选择图片（压缩成功）
2. 关闭 WiFi/数据
3. 点击上传

**期望结果**：
- 显示"连接已断开"
- 重连后可以继续上传

---

## ✅ 验收标准

### 图片压缩功能

- [ ] 大图（>1200px）自动压缩
- [ ] 小图（<1200px）保持不变
- [ ] 压缩率达到 80%+ （大图）
- [ ] 压缩信息正确显示
- [ ] 原始尺寸和压缩后尺寸显示正确
- [ ] 压缩质量可接受（无明显失真）

### UI 优化功能

- [ ] 选择图片后上传区域消失
- [ ] 点击更换图片后上传区域重现
- [ ] 上传成功后上传区域重现
- [ ] 空间节约约 150px
- [ ] 所有按钮始终可见
- [ ] 动画过渡流畅

### 用户体验

- [ ] 处理速度快（<500ms）
- [ ] 状态提示清晰
- [ ] 压缩信息易读
- [ ] 操作流程顺畅
- [ ] 无明显卡顿

### 兼容性

- [ ] iOS Safari 正常
- [ ] Android Chrome 正常
- [ ] 微信内置浏览器正常
- [ ] 各种屏幕尺寸正常

---

## 📊 性能测试

### 压缩性能

**测试图片**: 3000×2000, 5MB

测试 10 次，记录：
- 压缩时间
- 压缩后大小
- 压缩率

**目标**：
- 平均时间 < 500ms
- 平均大小 < 500KB
- 平均压缩率 > 85%

### 上传性能

**网络**: 4G (10 Mbps)

对比测试：
- 原图上传时间
- 压缩后上传时间

**目标**：
- 时间减少 > 80%

---

## 🔍 调试技巧

### 查看压缩详情

打开浏览器开发者工具：

```javascript
// 在控制台查看压缩信息
console.log('原始:', compressed.originalSize);
console.log('压缩:', compressed.compressedSize);
console.log('比例:', compressed.originalWidth, 'x', compressed.originalHeight);
```

### 验证实际尺寸

```javascript
// 检查实际传输的图片尺寸
const img = new Image();
img.onload = () => {
  console.log('实际尺寸:', img.width, 'x', img.height);
};
img.src = dataURL;
```

### 查看网络传输

开发者工具 > Network 标签：
- 查看 WebSocket 消息大小
- 验证传输的是压缩后的图片

---

## 📝 测试报告模板

### 功能测试

| 功能 | 状态 | 备注 |
|-----|------|-----|
| 图片压缩 | ✅/❌ | |
| UI 隐藏 | ✅/❌ | |
| 更换图片 | ✅/❌ | |
| 压缩信息 | ✅/❌ | |

### 性能测试

| 指标 | 目标 | 实际 | 结果 |
|-----|------|------|-----|
| 压缩时间 | <500ms | | ✅/❌ |
| 压缩率 | >85% | | ✅/❌ |
| 文件大小 | <500KB | | ✅/❌ |

### 兼容性测试

| 设备/浏览器 | 结果 | 问题 |
|-----------|------|-----|
| iOS Safari | ✅/❌ | |
| Android Chrome | ✅/❌ | |
| 微信浏览器 | ✅/❌ | |

### 问题记录

1. 
2. 
3. 

---

## 🎉 测试完成

完成所有测试后，确认：

- [ ] 所有核心功能正常
- [ ] 性能达标
- [ ] 无严重 Bug
- [ ] 用户体验良好

可以部署上线！🚀

